<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Handler | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">

	<link rel="stylesheet" href="/assets/css/app.css" />
	<link rel="stylesheet" href="/assets/css/print.css" media="print"/>

	<link rel="stylesheet" href="/common/css/devdocs.css" />
<link rel="alternate" type="application/rss+xml" title="Magento DevDocs RSS" href="/feed.xml" />

	<script>
  var baseUrl = "";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c"
  };
</script>




	<link rel="canonical" href="https://devdocs.magento.com/guides/v2.2/mtf/mtf_entities/mtf_handler.html">

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">

	<header class="site-header">

		<nav class="site-nav">

  <div class="menu-btn">
    <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main"></button>
  </div>

  <div class="nav-container">

    <a class="logo" href="/">
      <img src="/assets/i/m-logo.svg" alt=""><img src="/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      
<div class="version-switcher dropdown" data-version="2.2">
	<button id="version-switcher-button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Magento 2.2
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
		
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.0/mtf/mtf_entities/mtf_handler.html">Magento 2.0</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.1/mtf/mtf_entities/mtf_handler.html">Magento 2.1</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.2/mtf/mtf_entities/mtf_handler.html">Magento 2.2</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.3/mtf/mtf_entities/mtf_handler.html">Magento 2.3 Beta</a></li>
		
  </ul>
</div>


      <!-- Main Navigation -->


<ul class="nav-main" role="menubar">




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Cloud</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/cloud/bk-cloud.html">Cloud Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/cloud/architecture/cloud-architecture.html">Cloud Architecture</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/cloud/setup/first-time-setup.html">Local Development</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/cloud/env/environments.html">Configure Environments</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/cloud/project/project-upgrade-parent.html">Upgrades and Patches</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/cloud/release-notes/cloud-tools.html">Release Notes</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/install-gde/bk-install-guide.html">Installation Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/comp-mgr/bk-compman-upgrade-guide.html">Extension Update and System Upgrade Guide</a>
  </li>



          
        
          
          
            







          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/config-guide/bk-config-guide.html">Configuration Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/performance-best-practices/">Performance Best Practices</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/migration/bk-migration-guide.html">Migration Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/cloud/bk-cloud.html">Magento Commerce (Cloud) Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/release-notes/bk-release-notes.html">Release Information</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">Backend</div>
              <ul>
              
                





  
  
  
  <li>
    <a href="/guides/v2.2/architecture/bk-architecture.html">Architecture</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/mrg/intro.html">Module Reference Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/coding-standards/bk-coding-standards.html">Coding Standards</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/contributor-guide/contributing.html">Contributor Guide</a>
  </li>



              
              </ul>
            </div>
          
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">Frontend</div>
              <ul>
              
                





  
  
  
  <li>
    <a href="/guides/v2.2/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a>
  </li>



              
                







              
                





  
  
  
  <li>
    <a href="/guides/v2.2/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/pattern-library/bk-pattern.html">Admin Design Pattern Library</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/design-styleguide/bk-styleguide.html">Admin Style Guide</a>
  </li>



              
                







              
              </ul>
            </div>
          
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">API</div>
              <ul>
              
                





  
  
  
  <li>
    <a href="/guides/v2.2/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/rest/bk-rest.html">REST API Reference</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.2/soap/bk-soap.html">SOAP API Reference</a>
  </li>



              
                







              
                





  
  
  
  <li>
    <a href="/guides/v2.2/marketplace/eqp/api.html">Marketplace EQP API Reference</a>
  </li>



              
                





  
  
  
  <li>
    <a href="https://developers.rjmetrics.com/">Magento BI Import REST API</a>
  </li>



              
              </ul>
            </div>
          
        
      
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/test/testing.html">Magento Testing Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/mftf/2.2/introduction.html">Functional Acceptance Testing</a>
  </li>



          
        
          
          
            







          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/mtf/mtf_introduction.html">Functional Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/test/integration/integration_test_execution.html">Integration Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/test/js/jasmine.html">JavaScript Unit Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/test/unit/unit_test_execution.html">PHP Unit Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/get-started/web-api-functional-testing.html">Web API Functional Testing</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-separator"></li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/advanced-reporting/overview.html">Advanced Reporting</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/b2b/bk-b2b.html">B2B</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/howdoi/checkout/checkout_overview.html">Checkout</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="http://omsdocs.magento.com/en/">Order Management</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/payments-integrations/bk-payments-integrations.html">Payment Integrations</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/extension-dev-guide/staging.html">Staging</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/rest/tutorials/index.html">Rest Tutorials</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/howdoi/customize_product.html">Customize Product Creation Form</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.2/howdoi/checkout/checkout_overview.html">Customize Checkout</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/community/resources/support.html">Magento Support</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/videos/">Video Tutorials</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  



</ul><!-- /.nav-main -->
    </div>

    <div class="search-btn">
      <button class="search-trigger search-icon"></button>
    </div>

    <form class="quick-search" action="/guides/v2.2/search.html" method="get" novalidate="novalidate">
      <input type="search" name="q" placeholder="Search" />
      <button class="quick-search-close">&times;</button>
    </form>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		




		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" data-proofer-ignore class="toc-toggler">Table of Contents</a>
	<div class="sidebar-wrapper">

		
		
		<h4 class="guide-title">Functional Testing Framework Guide</h4>
		<div class="collapsible-navigation">
		    <ul>
		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_introduction.html">Introduction</a>
  

  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_installation.html">Installation</a>
  

  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_quickstart.html">Quick Start</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_quickstart/mtf_quickstart_config.html">Adjust configuration</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_quickstart/mtf_quickstart_magento.html">Prepare Magento application</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_quickstart/mtf_quickstart_environment.html">Prepare environment for test run</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_quickstart/mtf_quickstart_runtest.html">Test run</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_quickstart/mtf_quickstart_logs.html">See logs for failed tests</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/create_test.html">Create a Test</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/create_test/out-of-the-box.html">Out-of-the-box test</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/create_test/new_test.html">New functional test. Theory</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/create_test/create_new_test.html">New functional test. Practice</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/features.html">Features</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/features/isolation.html">Isolation management</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/features/modularity.html">Modularity</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/features/parallel_execution.html">Parallel execution flow</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/features/reporting.html">Reporting</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/features/test_suite.html">Test suite</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/features/webdriver.html">Web driver replacement</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities.html">Entities</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_fixture.html">Fixture</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_fixture-repo.html">Fixture Repository</a>
  

  
</li>



      
         





  
  
  

  
  
<li class="active ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_handler.html">Handler</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_block.html">Block</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_typified-element.html">Typified element</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_page.html">Page</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_constraint.html">Constraint</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_dataset.html">Data set</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_testcase.html">Test case</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_entities/mtf_scenariotest.html">Scenario test</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/configuration.html">Configuration</a>
  

  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/mtf_update.html">Update</a>
  

  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.2/mtf/troubleshooting.html">Troubleshooting</a>
  

  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="https://github.com/magento/mtf/blob/develop/CHANGELOG.md">Changelog</a>
  

  
</li>



		    
		    </ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->

	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

	

	

	<h1 class="page-heading">Handler</h1>

  


</section>

			<p>You can use a handler to set up preconditions and prepare an initial testing environment for particular tests.
For example, your scenario requires a particular   <span term-uuid="f0dcf847-ce21-4b88-8b45-83e1cbf08100" class="glossary-term" data-toggle="popover">widget</span>
 that must be implicitly created before the test is started.
You need a <a href="/guides/v2.2/mtf/mtf_entities/mtf_fixture.html">fixture</a>, a <a href="/guides/v2.2/mtf/mtf_entities/mtf_dataset.html">data set</a>, and a handler.
The handler transfers data to the application being tested.
The data is a list of fields from a fixture and values from data sets.</p>

<p>This topic focuses on handlers, and we’ll discuss types of handlers as well as how to create and use one.</p>

<h2 id="mtf_handler_types">Types of handlers</h2>

<p>The FTF enables you to use any type of handler.</p>

<p>Magento uses the following handlers:</p>

<table>
  <thead>
    <tr>
      <th>Type of handler</th>
      <th>Mechanism</th>
      <th>Example</th>
      <th>Tip</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>UI</td>
      <td>Drives the web browser.</td>
      <td>Set of scripts for Selenium that simulate user actions to create a widget through a web browser.</td>
      <td>The UI handler is much slower then the other handlers. When the test execution time is critical, you should avoid use of the UI handler. The UI handler code is very similar to the code of the test that doesn’t contain constraints. If you have a test for widget creation, you can re-use the code, because the code of UI handler that creates widget is very similar.</td>
    </tr>
    <tr>
      <td>cURL</td>
      <td>Sends POST or PUT requests to the server hosting the application that is being tested.</td>
      <td>HTTP POST request to the application server, that transfers Widget fixture fields and corresponding values from the data set.</td>
      <td>Browser is not involved, that’s why the cURL handler works much faster than the UI handler.</td>
    </tr>
    <tr>
      <td>WebAPI</td>
      <td>Sends a POST request using the REST API. <a href="/guides/v2.2/rest/bk-rest.html">See REST API reference documentation.</a></td>
      <td>Similar to cURL but uses the REST API  entry point.</td>
      <td>Has the advantage of testing the API, faster than cURL.</td>
    </tr>
  </tbody>
</table>

<p>Furthermore, you can create your own handlers, such as <strong>Direct</strong>, which is very fast because the <strong>Direct</strong> handler sends a direct call to the Magento application using Magento models.
The <strong>Direct</strong> handler requires deep understanding of the Magento application, and also requires access to the Magento code and the database.
Difficulties can be caused when the Magento code and Magento tests are run on different hosts.</p>

<h2 id="mtf_handler_config">Configuration</h2>

<p>One fixture can have various handlers.
When we create an   <span term-uuid="a9027f5d-efab-4662-96aa-c2999b5ab259" class="glossary-term" data-toggle="popover">entity</span>
 in the test we do not indicate which handler to use.
This work is delegated to a fallback, which is a queue of handlers in the priority order specified in <a href="#mtf_handler_configxml"><code class="highlighter-rouge">config.xml</code></a>.</p>

<h3 id="mtf_handler_configxml"><code class="highlighter-rouge">config.xml</code></h3>

<p>The default configuration for handlers is set in <a href="https://github.com/magento/magento2/blob/2.0/dev/tests/functional/etc/config.xml.dist"><code class="highlighter-rouge">&lt;magento2&gt;/dev/tests/functional/etc/config.xml.dist</code></a>. 
Create a duplicate of the file, and keep both, but make changes to the new one, which is called <code class="highlighter-rouge">config.xml</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp config.xml.dist config.xml
</code></pre></div></div>

<p>The following nodes influence handlers:</p>

<table>
<tr><th>Node</th><th>Semantics</th><th>Example</th></tr>
<tr><td><code>&lt;backendLoginUrl&gt;</code></td><td>Reference to the login form of the   <span term-uuid="29ddb393-ca22-4df9-a8d4-0024d75739b1" class="glossary-term" data-toggle="popover">Admin</span>
.</td><td><code>&lt;backendLoginUrl&gt;admin/auth/login&lt;/backendLoginUrl&gt;</code></td></tr>
<tr><td><code>&lt;backendLogin&gt;</code></td><td>A username to access the Admin as a Magento administrator.</td><td><code>&lt;backendLogin&gt;admin&lt;/backendLogin&gt;</code></td></tr>
<tr><td><code>&lt;backendPassword&gt;</code></td><td>A password to access the Admin as a Magento administrator.</td><td><code>&lt;backendPassword&gt;pas$worD&lt;/backendPassword&gt;</code></td></tr>
<tr><td><code>&lt;handler&gt;</code></td><td>Specifies priorities for different types of handler. The less the value, the higher the priority. The highest priority has value <code>0</code>. <code>token</code> contains <a href="/guides/v2.2/get-started/authentication/gs-authentication.html">access token</a> (used by WebAPI handlers only).</td>
<td><pre>
&lt;handler&gt;
  &lt;webapi priority="0"&gt;
    &lt;token&gt;integration_token&lt;/token&gt;
  &lt;/webapi&gt;
  &lt;curl priority="1" /&gt;
  &lt;ui priority="2" /&gt;
&lt;/handler&gt;
</pre>
</td></tr>
</table>

<h2 id="mtf_handler-components">Handler components</h2>

<h3 id="mtf_handler_interface">Handler interface</h3>

<p>Each handler must implement a handler interface.</p>

<p>You should mention in a fixture the <code class="highlighter-rouge">handler_interface</code> attribute with a reference to the PHP class: <code class="highlighter-rouge">Magento\[module_name]\Test\Handler\[object_name]\[object_name]Interface</code> (example for the Widget: <code class="highlighter-rouge">Magento\Widget\Test\Handler\Widget\WidgetInterface</code>).</p>

<p>Example of <code class="highlighter-rouge">WidgetInterface.php</code> (should be placed in <code class="highlighter-rouge">&lt;magento2_root_dir&gt;/dev/tests/functional/tests/app/Magento/Widget/Test/Handler/Widget</code>):</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Magento\Widget\Test\Handler\Widget</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Magento\Mtf\Handler\HandlerInterface</span><span class="p">;</span>

<span class="sd">/**
 * Interface WidgetInterface
 */</span>
<span class="k">interface</span> <span class="nx">WidgetInterface</span> <span class="k">extends</span> <span class="nx">HandlerInterface</span>
<span class="p">{</span>
    <span class="c1">//
</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="mtf_handler_conf_hand">Handler class</h3>

<p>To use the handler class, create <a href="#mtf_handler_interface">an interface</a>, declare a fallback in the <a href="#mtf_handler_config"><code class="highlighter-rouge">config.xml</code></a>, and declare interface/class relationships in the <a href="#mtf_handler_di"><code class="highlighter-rouge">di.xml</code></a>.
When this class is created, you can call the <code class="highlighter-rouge">persist()</code> method to create Magento entity (for example, widget).
The method returns data that are matched with fixture fields.
All fixture fields that are matched are assigned values from the handler.</p>

<p>The <code class="highlighter-rouge">persist()</code> method is declared in the <a href="https://github.com/magento/mtf/blob/develop/Magento/Mtf/Fixture/InjectableFixture.php"><code class="highlighter-rouge">InjectableFixture</code></a> class by path <code class="highlighter-rouge">&lt;magento2_root_dir&gt;/dev/tests/functional/vendor/magento/mtf/Magento/Mtf/Fixture/InjectableFixture.php</code>.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Persists Fixture Data into application.
 *
 * @return void
 */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">persist</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="o">-&gt;</span><span class="na">dispatchEvent</span><span class="p">([</span><span class="s1">'persist_before'</span><span class="p">],</span> <span class="p">[</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$this</span><span class="p">)]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handlerInterface</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handlerFactory</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">handlerInterface</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$result</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="o">-&gt;</span><span class="na">dispatchEvent</span><span class="p">([</span><span class="s1">'persist_after'</span><span class="p">],</span> <span class="p">[</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$this</span><span class="p">)]);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Create the handler in the same directory where the interface is stored: <code class="highlighter-rouge">&lt;magento2_root_dir&gt;/dev/tests/functional/tests/app/Magento/[module_name]/Test/Handler/[object_name]/[type_of_handler].php</code></p>

<h3 id="mtf_handler_di"><code class="highlighter-rouge">di.xml</code></h3>

<p>The <code class="highlighter-rouge">di.xml</code> file declares relationship between the <a href="#mtf_handler_interface">interface</a> and the <a href="#mtf_handler_conf_hand">handler</a> class.
The file must be placed in <code class="highlighter-rouge">&lt;magento2_root_dir&gt;/dev/tests/functional/tests/app/Magento/[module_name]/Test/etc/[handler_type]</code>.</p>

<p>See an example for the Widget cURL handler (<code class="highlighter-rouge">&lt;magento2_root_dir&gt;/dev/tests/functional/tests/app/Magento/Widget/Test/etc/curl/di.xml</code>):</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" ?&gt;</span>
<span class="c">&lt;!--
/**
 * Copyright © Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
--&gt;</span>
<span class="nt">&lt;config</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:framework:ObjectManager/etc/config.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;preference</span> <span class="na">for=</span><span class="s">"Magento\Widget\Test\Handler\Widget\WidgetInterface"</span> <span class="na">type=</span><span class="s">"\Magento\Widget\Test\Handler\Widget\Curl"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">"Magento\Widget\Test\Constraint\AssertProductInCatalogNewProductsList"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"severity"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>S2<span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/type&gt;</span>
<span class="nt">&lt;/config&gt;</span>

</code></pre></div></div>

<p>In this example, the <code class="highlighter-rouge">di.xml</code> file causes the <code class="highlighter-rouge">Curl</code> class to replace the <code class="highlighter-rouge">WidgetInterface</code>.</p>

<p>See the directory structure mentioned for the case with the Widget cURL handler:</p>

<p><img src="/common/images/ftf/mtf_widget_handler_tree.png" alt="" /></p>

<h2 id="mtf_handler_howto-create-curl">How to create a cURL handler</h2>

<p>Let’s create a cURL handler that creates a new widget.</p>

<ul>
  <li>Create a directory with the name <code class="highlighter-rouge">Widget</code> in the <code class="highlighter-rouge">Handler</code> directory of the Magento_Widget module - <code class="highlighter-rouge">&lt;magento2_root_dir&gt;/dev/tests/functional/tests/app/Magento/Widget/Test/Handler/Widget</code>.</li>
  <li>
    <p>In the same directory, create <a href="#mtf_handler_interface">the interface</a> for the cURL handler, and call the file <code class="highlighter-rouge">WidgetInterface.php</code>.
Our new interface extends <code class="highlighter-rouge">HandlerInterface</code> class.</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Magento\Widget\Test\Handler\Widget</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Magento\Mtf\Handler\HandlerInterface</span><span class="p">;</span>

<span class="sd">/**
* Interface WidgetInterface
*/</span>
<span class="k">interface</span> <span class="nx">WidgetInterface</span> <span class="k">extends</span> <span class="nx">HandlerInterface</span>
<span class="p">{</span>
    <span class="c1">//
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create <code class="highlighter-rouge">Curl.php</code> in the same directory.
This file contains a <a href="#mtf_handler_conf_hand">handler class</a>, which defines preparation of a data to create a new widget.</p>

    <p id="mtf_curl_script">The following code includes detailed comments for better understanding.</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Magento\Widget\Test\Handler\Widget</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Magento\Mtf\Fixture\FixtureInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Handler\Curl</span> <span class="k">as</span> <span class="nx">AbstractCurl</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Util\Protocol\CurlTransport</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Util\Protocol\CurlTransport\BackendDecorator</span><span class="p">;</span>

<span class="sd">/**
* Curl handler for creating widgetInstance/frontendApp.
*/</span>
<span class="k">class</span> <span class="nc">Curl</span> <span class="k">extends</span> <span class="nx">AbstractCurl</span>
<span class="p">{</span>
    <span class="sd">/**
    * Mapping values for data.
    *
    * @var array
    */</span>
    <span class="k">protected</span> <span class="nv">$mappingData</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'code'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'CMS Page Link'</span> <span class="o">=&gt;</span> <span class="s1">'cms_page_link'</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">'block'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'Main Content Area'</span> <span class="o">=&gt;</span> <span class="s1">'content'</span><span class="p">,</span>
            <span class="s1">'Sidebar Additional'</span> <span class="o">=&gt;</span> <span class="s1">'sidebar.additional'</span><span class="p">,</span>
            <span class="s1">'Sidebar Main'</span> <span class="o">=&gt;</span> <span class="s1">'sidebar.main'</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">];</span>

    <span class="sd">/**
    * Post request for creating widget instance.
    *
    * @param FixtureInterface $fixture [optional]
    * @throws \Exception
    * @return null|array instance id
    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">persist</span><span class="p">(</span><span class="nx">FixtureInterface</span> <span class="nv">$fixture</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Prepare data to send it using cURL.
</span>        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">prepareData</span><span class="p">(</span><span class="nv">$fixture</span><span class="p">);</span>
        <span class="c1">// Build url to send post request to create widget.
</span>        <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">'app_backend_url'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'admin/widget_instance/save/code/'</span>
            <span class="o">.</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'code'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'/theme_id/'</span> <span class="o">.</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'theme_id'</span><span class="p">];</span>
        <span class="c1">// Create CurlTransport instance to operate with cURL. BackendDecorator is used to log in to Magento backend.
</span>        <span class="nv">$curl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BackendDecorator</span><span class="p">(</span><span class="k">new</span> <span class="nx">CurlTransport</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_configuration</span><span class="p">);</span>
        <span class="c1">// Send request to url with prepared data.
</span>        <span class="nv">$curl</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
        <span class="c1">// Read response.
</span>        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$curl</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">();</span>
        <span class="c1">// Close connection to server.
</span>        <span class="nv">$curl</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
        <span class="c1">// Verify whether request has been successful (check if success message is present).
</span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$response</span><span class="p">,</span> <span class="s1">'data-ui-id="messages-message-success"'</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s2">"Widget instance creation by curl handler was not successful! Response: </span><span class="nv">$response</span><span class="s2">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Get id of created widget in order to use in other tests.
</span>        <span class="nv">$id</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">'/\/widget_instance\/edit\/instance_id\/(\d+)/'</span><span class="p">,</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nb">count</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**
    * Prepare data to create widget.
    *
    * @param FixtureInterface $widget
    * @return array
    */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">prepareData</span><span class="p">(</span><span class="nx">FixtureInterface</span> <span class="nv">$widget</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Replace UI fixture values with values that are applicable for cURL. Property $mappingData is used.
</span>        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">replaceMappingData</span><span class="p">(</span><span class="nv">$widget</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
        <span class="c1">// Perform data manipulations to prepare the cURL request based on input data.
</span>        <span class="o">...</span>
        <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Additional methods.
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>Create <a href="#mtf_handler_di"><code class="highlighter-rouge">di.xml</code></a> in the <code class="highlighter-rouge">etc/curl</code> directory of the Magento_Widget module.</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" ?&gt;</span>
<span class="c">&lt;!--
/**
 * Copyright © Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */
--&gt;</span>
<span class="nt">&lt;config</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:framework:ObjectManager/etc/config.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;preference</span> <span class="na">for=</span><span class="s">"Magento\Widget\Test\Handler\Widget\WidgetInterface"</span> <span class="na">type=</span><span class="s">"Magento\Widget\Test\Handler\Widget\Curl"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/config&gt;</span>

</code></pre></div></div>

<h3 id="mtf_handler_decor">cURL authentication classes</h3>

<p>In the previously mentioned example of the <a href="#mtf_curl_script">Curl.php</a> code, authentication in the Admin is realized using the <code class="highlighter-rouge">BackendDecorator</code> class.</p>

<p>The <a href="#mtf_handler_curl_frontdecor">FrontendDecorator class</a> manages authentication in the   <span term-uuid="1a70d3ac-6bd9-475a-8937-5f80ca785c14" class="glossary-term" data-toggle="popover">storefront</span>
.</p>

<h4 id="mtf_handler_curl_backdecor">BackendDecorator class</h4>

<p><code class="highlighter-rouge">BackendDecorator</code> manages authentication in Admin and saves the Admin’s session.</p>

<p>Full class name is <code class="highlighter-rouge">Mtf\Util\Protocol\CurlTransport\BackendDecorator</code>.</p>

<p>Add to the <code class="highlighter-rouge">Curl.php</code> the following code:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$curl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BackendDecorator</span><span class="p">(</span><span class="k">new</span> <span class="nx">CurlTransport</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">Config</span><span class="p">());</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Config()</code> takes Admin’s configuration from <a href="#mtf_handler_configxml">config.xml</a>, where the username and the password are stored.</p>

<h4 id="mtf_handler_curl_frontdecor">FrontendDecorator class</h4>

<p><code class="highlighter-rouge">FrontendDecorator</code> helps to authorize the customer and saves his session.</p>

<p>Full class name is <code class="highlighter-rouge">Mtf\Util\Protocol\CurlTransport\FrontendDecorator</code>.</p>

<p>Use the following code in the <code class="highlighter-rouge">Curl.php</code> file:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$curl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FrontendDecorator</span><span class="p">(</span><span class="k">new</span> <span class="nx">CurlTransport</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">customer</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="mtf_handler_howto-create-ui">How to create a UI handler</h2>

<p>Let’s create a UI handler that creates a new widget.</p>

<ul>
  <li>Create a directory with the name <code class="highlighter-rouge">Widget</code> in the <code class="highlighter-rouge">Handler</code> directory of the Magento_Widget module - <code class="highlighter-rouge">&lt;magento2_root_dir&gt;/dev/tests/functional/tests/app/Magento/Widget/Test/Handler/Widget</code>.</li>
  <li>
    <p>In the same directory, create <a href="#mtf_handler_interface">interface</a> for the UI handler, and call the file <code class="highlighter-rouge">WidgetInterface.php</code>.
Our new interface extends <code class="highlighter-rouge">HandlerInterface</code> class.</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Magento\Widget\Test\Handler\Widget</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Magento\Mtf\Handler\HandlerInterface</span><span class="p">;</span>

<span class="sd">/**
* Interface WidgetInterface
*/</span>
<span class="k">interface</span> <span class="nx">WidgetInterface</span> <span class="k">extends</span> <span class="nx">HandlerInterface</span>
<span class="p">{</span>
    <span class="c1">//
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create <code class="highlighter-rouge">Ui.php</code> in the same directory.
This file contains a <a href="#mtf_handler_conf_hand">handler class</a>, which defines preparation of a data to create a new widget.</p>

    <p>The code has detailed comments for better understanding.</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Magento\Widget\Test\Handler\Widget</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Magento\Mtf\Fixture\FixtureInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Handler\Curl</span> <span class="k">as</span> <span class="nx">AbstractCurl</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Util\Protocol\CurlTransport</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Util\Protocol\CurlTransport\BackendDecorator</span><span class="p">;</span>

<span class="sd">/**
* Curl handler for creating widgetInstance/frontendApp.
*/</span>
<span class="k">class</span> <span class="nc">Curl</span> <span class="k">extends</span> <span class="nx">AbstractCurl</span>
<span class="p">{</span>
    <span class="sd">/**
    * Mapping values for data.
    *
    * @var array
    */</span>
    <span class="k">protected</span> <span class="nv">$mappingData</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'code'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'CMS Page Link'</span> <span class="o">=&gt;</span> <span class="s1">'cms_page_link'</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">'block'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'Main Content Area'</span> <span class="o">=&gt;</span> <span class="s1">'content'</span><span class="p">,</span>
            <span class="s1">'Sidebar Additional'</span> <span class="o">=&gt;</span> <span class="s1">'sidebar.additional'</span><span class="p">,</span>
            <span class="s1">'Sidebar Main'</span> <span class="o">=&gt;</span> <span class="s1">'sidebar.main'</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">];</span>

    <span class="sd">/**
    * Post request for creating widget instance.
    *
    * @param FixtureInterface $fixture [optional]
    * @throws \Exception
    * @return null|array instance id
    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">persist</span><span class="p">(</span><span class="nx">FixtureInterface</span> <span class="nv">$fixture</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Prepare data to send it using cURL.
</span>        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">prepareData</span><span class="p">(</span><span class="nv">$fixture</span><span class="p">);</span>
        <span class="c1">// Build url to send post request to create widget.
</span>        <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">'app_backend_url'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'admin/widget_instance/save/code/'</span>
            <span class="o">.</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'code'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'/theme_id/'</span> <span class="o">.</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'theme_id'</span><span class="p">];</span>
        <span class="c1">// Create CurlTransport instance to operate with cURL. BackendDecorator is used to log in to Magento backend.
</span>        <span class="nv">$curl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BackendDecorator</span><span class="p">(</span><span class="k">new</span> <span class="nx">CurlTransport</span><span class="p">(),</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_configuration</span><span class="p">);</span>
        <span class="c1">// Send request to url with prepared data.
</span>        <span class="nv">$curl</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
        <span class="c1">// Read response.
</span>        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$curl</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">();</span>
        <span class="c1">// Close connection to server.
</span>        <span class="nv">$curl</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
        <span class="c1">// Verify whether request has been successful (check if success message is present).
</span>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$response</span><span class="p">,</span> <span class="s1">'data-ui-id="messages-message-success"'</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s2">"Widget instance creation by curl handler was not successful! Response: </span><span class="nv">$response</span><span class="s2">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Get id of created widget in order to use in other tests.
</span>        <span class="nv">$id</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">'/\/widget_instance\/edit\/instance_id\/(\d+)/'</span><span class="p">,</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nb">count</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**
    * Prepare data to create widget.
    *
    * @param FixtureInterface $widget
    * @return array
    */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">prepareData</span><span class="p">(</span><span class="nx">FixtureInterface</span> <span class="nv">$widget</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Replace UI fixture values with values that are applicable for cURL. Property $mappingData is used.
</span>        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">replaceMappingData</span><span class="p">(</span><span class="nv">$widget</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
        <span class="c1">// Perform data manipulations to prepare the cURL request based on input data.
</span>        <span class="o">...</span>
        <span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Additional methods.
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create <a href="#mtf_handler_di"><code class="highlighter-rouge">di.xml</code></a> in the <code class="highlighter-rouge">etc/ui</code> directory of the Magento_Widget   <span term-uuid="c1e4242b-1f1a-44c3-9d72-1d5b1435e142" class="glossary-term" data-toggle="popover">module</span>
.</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" ?&gt;</span>

<span class="nt">&lt;config</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:framework:ObjectManager/etc/config.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;preference</span> <span class="na">for=</span><span class="s">"Magento\Widget\Test\Handler\Widget\WidgetInterface"</span>
                <span class="na">type=</span><span class="s">"\Magento\Widget\Test\Handler\Widget\Ui"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="mtf_handler_howto-create-webapi">How to create a WebAPI handler</h2>

<p>Let’s create a WebAPI handler that creates a new   <span term-uuid="f35f5e81-db5d-4754-937e-b5607ac255fa" class="glossary-term" data-toggle="popover">tax rule</span>
.</p>

<ul>
  <li>Create a directory with the name <code class="highlighter-rouge">TaxRule</code> in the <code class="highlighter-rouge">Handler</code> directory of the Magento_Tax module - <code class="highlighter-rouge">&lt;magento2_root_dir&gt;/dev/tests/functional/tests/app/Magento/Tax/Test/Handler/TaxRule</code>.</li>
  <li>
    <p>In the same directory, create <a href="#mtf_handler_interface">interface</a> for the WebAPI handler, and call the file <code class="highlighter-rouge">TaxRuleInterface.php</code>.
Our new interface extends <code class="highlighter-rouge">HandlerInterface</code> class.</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">namespace</span> <span class="nx">Magento\Tax\Test\Handler\TaxRule</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Magento\Mtf\Handler\HandlerInterface</span><span class="p">;</span>

<span class="sd">/**
* Interface TaxRuleInterface
*/</span>
<span class="k">interface</span> <span class="nx">TaxRuleInterface</span> <span class="k">extends</span> <span class="nx">HandlerInterface</span>
<span class="p">{</span>
    <span class="c1">//
</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create <code class="highlighter-rouge">Webapi.php</code> in the same directory.
The file contains a <a href="#mtf_handler_conf_hand">handler class</a>.
In the following example WebAPI handler uses some cURL handler methods to prepare data.</p>

    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Magento\Tax\Test\Handler\TaxRule</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Magento\Tax\Test\Fixture\TaxRule</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Config\DataInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Fixture\FixtureInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Util\Protocol\CurlTransport</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Handler\Webapi</span> <span class="k">as</span> <span class="nx">AbstractWebapi</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\System\Event\EventManagerInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Mtf\Util\Protocol\CurlTransport\WebapiDecorator</span><span class="p">;</span>

<span class="sd">/**
* Create Tax Rule via Web API handler.
*/</span>
<span class="k">class</span> <span class="nc">Webapi</span> <span class="k">extends</span> <span class="nx">AbstractWebapi</span> <span class="k">implements</span> <span class="nx">TaxRuleInterface</span>
<span class="p">{</span>
    <span class="sd">/**
    * Tax Rule cUrl handler.
    *
    * @var Curl
    */</span>
    <span class="k">protected</span> <span class="nv">$taxRuleCurl</span><span class="p">;</span>

    <span class="sd">/**
    * @constructor
    * @param DataInterface $configuration
    * @param EventManagerInterface $eventManager
    * @param WebapiDecorator $webapiTransport
    * @param Curl $taxRuleCurl
    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span>
        <span class="nx">DataInterface</span> <span class="nv">$configuration</span><span class="p">,</span>
        <span class="nx">EventManagerInterface</span> <span class="nv">$eventManager</span><span class="p">,</span>
        <span class="nx">WebapiDecorator</span> <span class="nv">$webapiTransport</span><span class="p">,</span>
        <span class="nx">Curl</span> <span class="nv">$taxRuleCurl</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$configuration</span><span class="p">,</span> <span class="nv">$eventManager</span><span class="p">,</span> <span class="nv">$webapiTransport</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taxRuleCurl</span> <span class="o">=</span> <span class="nv">$taxRuleCurl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
    * Web API request for creating Tax Rule.
    *
    * @param FixtureInterface $fixture
    * @return array
    * @throws \Exception
    */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">persist</span><span class="p">(</span><span class="nx">FixtureInterface</span> <span class="nv">$fixture</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var TaxRule $fixture */</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">prepareData</span><span class="p">(</span><span class="nv">$fixture</span><span class="p">);</span>

        <span class="nv">$url</span> <span class="o">=</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">'app_frontend_url'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'rest/V1/taxRules'</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">webapiTransport</span><span class="o">-&gt;</span><span class="na">write</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">webapiTransport</span><span class="o">-&gt;</span><span class="na">read</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">webapiTransport</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$response</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="o">-&gt;</span><span class="na">dispatchEvent</span><span class="p">([</span><span class="s1">'webapi_failed'</span><span class="p">],</span> <span class="p">[</span><span class="nv">$response</span><span class="p">]);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s1">'Tax rule creation by Web API handler was not successful!'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]];</span>
    <span class="p">}</span>

    <span class="sd">/**
    * Returns data for Web API params.
    *
    * @param TaxRule $fixture
    * @return array
    */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">prepareData</span><span class="p">(</span><span class="nx">TaxRule</span> <span class="nv">$fixture</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$fixture</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taxRuleCurl</span><span class="o">-&gt;</span><span class="na">prepareFieldData</span><span class="p">(</span><span class="nv">$fixture</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="s1">'tax_rate'</span><span class="p">,</span> <span class="s1">'tax_rate_ids'</span><span class="p">);</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taxRuleCurl</span><span class="o">-&gt;</span><span class="na">prepareFieldData</span><span class="p">(</span><span class="nv">$fixture</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="s1">'tax_product_class'</span><span class="p">,</span> <span class="s1">'product_tax_class_ids'</span><span class="p">);</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taxRuleCurl</span><span class="o">-&gt;</span><span class="na">prepareFieldData</span><span class="p">(</span><span class="nv">$fixture</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="s1">'tax_customer_class'</span><span class="p">,</span> <span class="s1">'customer_tax_class_ids'</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">[</span><span class="s1">'rule'</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create <a href="#mtf_handler_di"><code class="highlighter-rouge">di.xml</code></a> in the <code class="highlighter-rouge">etc/webapi</code> directory of the Magento_Tax module.</p>

    <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" ?&gt;</span>

<span class="nt">&lt;config</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:framework:ObjectManager/etc/config.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;preference</span> <span class="na">for=</span><span class="s">"Magento\Tax\Test\Handler\TaxRule\TaxRuleInterface"</span>
                <span class="na">type=</span><span class="s">"\Magento\Tax\Test\Handler\TaxRule\Webapi"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div>    </div>
  </li>
</ul>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  


  

    <div class="github-link">
      <a class="improve-page" href="https://github.com/magento/devdocs/blob/master/guides/v2.2/mtf/mtf_entities/mtf_handler.md" target="_blank">
        Edit this page on GitHub
      </a>
    </div>

    <div class="new-issue">
      <a href="https://github.com/magento/devdocs/issues/new?title=Feedback on page: /guides/v2.2/mtf/mtf_entities/mtf_handler.html" target="_blank">
        Give us feedback
      </a>
    </div>

  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav footer-links">
  <li><a href="https://github.com/magento/devdocs/blob/master/.github/CONTRIBUTING.md">Become a Contributor</a>
  <li><a href="https://magento.github.io/glossary/index.html?audience=developer">Glossary</a></li>
  <li><a href="http://magento.com/legal/terms/privacy/">Privacy Policy</a></li>
  <li><a href="http://magento.com/legal/terms/">Terms of Service</a></li>
  <li><a href="http://magento.com/legal/licensing/">License/Trademark FAQ</a></li>
  <!-- If the page is in the root, the link points to the default version of release notes.
       The default version is set in the config.yaml.-->
  <li><a href="/guides/v2.2/release-notes/bk-release-notes.html">Release Notes</a></li>
  <li><a href="/magento-third-party.html">Third-Party Licenses</a></li>
</ul>

    </div>

		<div class="copyright-date">&copy; 2018 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/assets/js/app.min.js"></script>






</body>
</html>

