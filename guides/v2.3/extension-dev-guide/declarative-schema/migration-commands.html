<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Migrate install/upgrade scripts to declarative schema | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">

	<link rel="stylesheet" href="/assets/css/app.css" />
	<link rel="stylesheet" href="/assets/css/print.css" media="print"/>

	<link rel="stylesheet" href="/common/css/devdocs.css" />
<link rel="alternate" type="application/rss+xml" title="Magento DevDocs RSS" href="/feed.xml" />

	<script>
  var baseUrl = "";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c"
  };
</script>




	<link rel="canonical" href="https://devdocs.magento.com/guides/v2.3/extension-dev-guide/declarative-schema/migration-commands.html">

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">

	<header class="site-header">

		<nav class="site-nav">

  <div class="menu-btn">
    <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main"></button>
  </div>

  <div class="nav-container">

    <a class="logo" href="/guides/v2.3/">
      <img src="/assets/i/m-logo.svg" alt=""><img src="/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      
<div class="version-switcher dropdown" data-version="2.3">
	<button id="version-switcher-button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Magento 2.3 Beta
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
		
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.0/extension-dev-guide/declarative-schema/migration-commands.html">Magento 2.0</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.1/extension-dev-guide/declarative-schema/migration-commands.html">Magento 2.1</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.2/extension-dev-guide/declarative-schema/migration-commands.html">Magento 2.2</a></li>
		
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.3/extension-dev-guide/declarative-schema/migration-commands.html">Magento 2.3 Beta</a></li>
		
  </ul>
</div>


      <!-- Main Navigation -->


<ul class="nav-main" role="menubar">




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Cloud</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/cloud/bk-cloud.html">Cloud Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/cloud/architecture/cloud-architecture.html">Cloud Architecture</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/cloud/setup/first-time-setup.html">Local Development</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/cloud/env/environments.html">Configure Environments</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/cloud/project/project-upgrade-parent.html">Upgrades and Patches</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/cloud/release-notes/cloud-tools.html">Release Notes</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/install-gde/bk-install-guide.html">Installation Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/comp-mgr/bk-compman-upgrade-guide.html">Extension Update and System Upgrade Guide</a>
  </li>



          
        
          
          
            







          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/config-guide/bk-config-guide.html">Configuration Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/performance-best-practices/">Performance Best Practices</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/migration/bk-migration-guide.html">Migration Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/cloud/bk-cloud.html">Magento Commerce (Cloud) Guide</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/release-notes/bk-release-notes.html">Release Information</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">Backend</div>
              <ul>
              
                





  
  
  
  <li>
    <a href="/guides/v2.3/architecture/bk-architecture.html">Architecture</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/mrg/intro.html">Module Reference Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/coding-standards/bk-coding-standards.html">Coding Standards</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/contributor-guide/contributing.html">Contributor Guide</a>
  </li>



              
              </ul>
            </div>
          
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">Frontend</div>
              <ul>
              
                





  
  
  
  <li>
    <a href="/guides/v2.3/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a>
  </li>



              
                







              
                





  
  
  
  <li>
    <a href="/guides/v2.3/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/pattern-library/bk-pattern.html">Admin Design Pattern Library</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/design-styleguide/bk-styleguide.html">Admin Style Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="https://magento-research.github.io/pwa-studio/">Magento PWA Documentation Site</a>
  </li>



              
              </ul>
            </div>
          
        
          
          
            <div class="nav-section">
              <div class="nav-section-title">API</div>
              <ul>
              
                





  
  
  
  <li>
    <a href="/guides/v2.3/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/rest/bk-rest.html">REST API Reference</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/soap/bk-soap.html">SOAP API Reference</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/graphql/">GraphQL Developer Guide</a>
  </li>



              
                





  
  
  
  <li>
    <a href="/guides/v2.3/marketplace/eqp/api.html">Marketplace EQP API Reference</a>
  </li>



              
                





  
  
  
  <li>
    <a href="https://developers.rjmetrics.com/">Magento BI Import REST API</a>
  </li>



              
              </ul>
            </div>
          
        
      
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/test/testing.html">Magento Testing Guide</a>
  </li>



          
        
          
          
            







          
        
          
          
            





  
  
  
  <li>
    <a href="/mftf/2.3/introduction.html">Functional Acceptance Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/mtf/mtf_introduction.html">Functional Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/test/integration/integration_test_execution.html">Integration Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/test/js/jasmine.html">JavaScript Unit Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/test/unit/unit_test_execution.html">PHP Unit Testing</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/get-started/web-api-functional-testing.html">Web API Functional Testing</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-separator"></li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/advanced-reporting/overview.html">Advanced Reporting</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/b2b/bk-b2b.html">B2B</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/howdoi/checkout/checkout_overview.html">Checkout</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="http://omsdocs.magento.com/en/">Order Management</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/payments-integrations/bk-payments-integrations.html">Payment Integrations</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/extension-dev-guide/staging.html">Staging</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  




  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span>

    
      <div class="nav-popup" role="menu" aria-hidden="true">

      

      
        <ul>
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/rest/tutorials/index.html">Rest Tutorials</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/howdoi/customize_product.html">Customize Product Creation Form</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/guides/v2.3/howdoi/checkout/checkout_overview.html">Customize Checkout</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/community/resources/support.html">Magento Support</a>
  </li>



          
        
          
          
            





  
  
  
  <li>
    <a href="/videos/">Video Tutorials</a>
  </li>



          
        
      </ul>
      

      </div>
    

  </li>
  



</ul><!-- /.nav-main -->
    </div>

    <div class="search-btn">
      <button class="search-trigger search-icon"></button>
    </div>

    <form class="quick-search" action="/guides/v2.3/search.html" method="get" novalidate="novalidate">
      <input type="search" name="q" placeholder="Search" />
      <button class="quick-search-close">&times;</button>
    </form>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		


<div class="message-banner">
    This is the 2.3 Beta release version of Magento documentation. Content in this version is subject to change.
</div>



		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" data-proofer-ignore class="toc-toggler">Table of Contents</a>
	<div class="sidebar-wrapper">

		
		
		<h4 class="guide-title">PHP Developer Guide</h4>
		<div class="collapsible-navigation">
		    <ul>
		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/bk-extension-dev-guide.html">Introduction</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/intro/developers_roadmap.html">Developer roadmap</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/intro/intro-composer.html">Introduction to Composer</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/intro/intro-composer-gloss.html">Glossary of common terms</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/prepare/prepare.html">Prepare (development quick start)</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/prepare/dev-modtypes.html">Component types</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/prepare/prepare_file-str.html">About component file structure</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/prepare/ext-repo-structure.html">Extension repository structure</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/prepare/dev-summary.html">Roadmap for developing and packaging components</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/prepare/lifecycle.html">Extension lifecycle</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/build.html">Build</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/di-xml-file.html">The di.xml file</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/optimal-dev-environment.html">Optimal development environment</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/composer-integration.html">The composer.json file</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/required-configuration-files.html">Define your configuration files</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/module-file-structure.html">Create your component file structure</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/component-registration.html">Register your component</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/XSD-XML-validation.html">URN schema validation</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/create_component.html">Name your component</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/module-load-order.html">Component load order</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/build/enable-module.html">Enable or disable your component</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/package/package.html">Package</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/package/package_module.html">Package a component</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/package/package_mktpl.html">Upload your component to the Magento Marketplace</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/validate/validate.html">Validate</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/validate/test-module.html">Test your component</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cache/partial-caching.html">Partial caching</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cache/partial-caching/database-caching.html">Create custom cache engines</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cache/partial-caching/create-cache-type.html">Create a cache type</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cache/page-caching.html">Full page caching</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cache/page-caching/public-content.html">Public content</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cache/page-caching/private-content.html">Private content</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cli-cmds/cli-add.html">Add CLI commands</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cli-cmds/cli-naming-guidelines.html">Command naming guidelines</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/cli-cmds/cli-howto.html">How to add CLI commands</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/staging.html">Staging (Magento Commerce only)</a>
  

  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/module-development.html">Component development</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/service-contracts/service-contracts.html">Service contracts</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/api-concepts.html">Public interfaces &amp; APIs</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/service-contracts/design-patterns.html">Service contract design patterns</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/depend-inj.html">Dependency injection</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/object-manager.html">ObjectManager</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/events-and-observers.html">Events and observers</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/factories.html">Factories</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/proxies.html">Proxies</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/code-generation.html">Code generation</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/attributes.html">EAV and extension attributes</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/plugins.html">Plugins (Interceptors)</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/routing.html">Routing</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <span>Indexing</span>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/indexing.html">Indexing overview</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/indexer-batch.html">Indexer optimization</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/indexing-custom.html">Adding a custom indexer</a>
  

  
</li>



      
    </ul>
  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <span>Declarative schema</span>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/declarative-schema/">Declarative schema overview</a>
  

  
</li>



      
         





  
  
  

  
  
<li class="active ">
  
    <a href="/guides/v2.3/extension-dev-guide/declarative-schema/migration-commands.html">Migrate install/upgrade scripts to declarative schema</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/declarative-schema/db-schema.html">Configure declarative schema</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/declarative-schema/data-patches.html">Develop data and schema patches</a>
  

  
</li>



      
    </ul>
  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <span>Web APIs</span>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/service-contracts/service-to-web-service.html">Configure services as web APIs</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/webapi/custom-routes.html">Set custom routes</a>
  

  
</li>



      
    </ul>
  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <span>Message Queues</span>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/message-queues/message-queues.html">Message queues overview</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/message-queues/config-mq.html">Configure message Queues</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/message-queues/queue-migration.html">Migrate message queue configuration</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/message-queues/bulk-operations.html">Bulk operations</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/message-queues/implement-bulk.html">Example bulk operations implementation</a>
  

  
</li>



      
    </ul>
  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/extension_attributes/adding-attributes.html">Adding extension attributes to entity</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/searching-with-repositories.html">Searching with repositories</a>
  

  
</li>



      
         







      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/howdoi/php/php_clear-dirs.html">Clear directories during development</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/adapters.html">Adapters</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/variable-pool/">Variable Pool</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <span>Configuration</span>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/configuration/sensitive-and-environment-settings.html">Sensitive Environment Settings</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/configuration/importers.html">Configuration Importers</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <span>Framework</span>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/framework/serializer.html">Serialize Library</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <span>Security</span>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/xss-protection.html">XSS Prevention</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/security/non-secure-functions.html">Non-secure functions</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    	





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/versioning/">Versioning</a>
  

  
    <ul>
      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/versioning/dependencies.html">Module version dependencies</a>
  

  
</li>



      
         





  
  
  

  
  
<li class=" ">
  
    <a href="/guides/v2.3/extension-dev-guide/versioning/codebase-changes.html">Codebase changes</a>
  

  
</li>



      
    </ul>
  
</li>



		    
		    </ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->

	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

	

	

	<h1 class="page-heading">Migrate install/upgrade scripts to declarative schema</h1>

  


</section>

			<p>Magento provides several commands to help convert your installation and upgrade scripts to declarative schema. These commands also help you test your changes, roll back your changes if anything goes wrong, and help your module maintain backward compatibility.</p>

<p class="bs-callout bs-callout-info">Once you start with data patches, you cannot continue to use upgrade scripts.</p>

<h2 id="convert-installupgrade-schema-scripts-to--db_schemaxml-files">Convert install/upgrade schema scripts to  db_schema.xml files</h2>

<p>The <strong>Schema Listener Tool</strong> converts pre-Magento 2.3 migration scripts into declarative schema. To use this tool, you specify an argument when you run the <code class="highlighter-rouge">setup:install</code> or <code class="highlighter-rouge">setup:upgrade</code> CLI command. As Magento is installed or upgraded, the system logs all schema changes per module, then persists the changes in a series of <code class="highlighter-rouge">db_schema.xml</code> files (one per affected module).</p>

<p class="bs-callout bs-callout-info">The Schema Listener tool listens for schema changes and attempts to change Magento code, so it should not be run in production mode. It is disabled by default.</p>

<p>To convert your install or upgrade script, run one of the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>magento setup:install <span class="nt">--convert-old-scripts</span><span class="o">=</span>1
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>magento setup:upgrade <span class="nt">--convert-old-scripts</span><span class="o">=</span>1
</code></pre></div></div>

<p class="bs-callout bs-callout-info">In Magento 2.3 Alpha, the <code class="highlighter-rouge">--convert-old-scripts</code> parameter was named <code class="highlighter-rouge">--convert_old_scripts</code>.</p>

<h3 id="troubleshooting">Troubleshooting</h3>

<p>The Schema Listener Tool cannot convert everything that can appear in a pre-Magento 2.3 migration script.</p>

<ul>
  <li>The tool supports only DDL operations represented in <code class="highlighter-rouge">\Magento\Framework\DB\Adapter\Pdo\Mysql</code>. As a result, the tool ignores all custom DDL operations.</li>
  <li>The tool ignores all raw SQL in your <code class="highlighter-rouge">InstallSchema</code> or <code class="highlighter-rouge">UpgradeSchema</code> scripts.</li>
  <li>Any DDL statements in a <code class="highlighter-rouge">Recurring</code> file will not be transferred to the new schema, because this file should be designed to run during each installation or upgrade.</li>
  <li>See <a href="/guides/v2.3/extension-dev-guide/declarative-schema/db-schema.html">Configure declarative schema</a> if you need to make manual modifications to your schema.</li>
</ul>

<h2 id="convert-installupgrade-data-scripts-to-the-data-patch-format">Convert install/upgrade data scripts to the data patch format</h2>

<p>Old data scripts cannot be converted automatically. The following steps help make the conversion go as smoothly as possible.</p>

<ol>
  <li>
    <p>Generate a patch stub.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> setup:db-declaration:generate-patch <span class="o">[</span>options] &lt;module-name&gt; &lt;patch-name&gt;
</code></pre></div>    </div>
    <p>where <code class="highlighter-rouge">[options]</code> can be any of the following:</p>

    <p><code class="highlighter-rouge">--revertable[=true | false]</code> - Determines whether the patch is revertable. The default value is <code class="highlighter-rouge">false</code>.</p>

    <p><code class="highlighter-rouge">--type[=&lt;type&gt;]</code> - Specifies what type of patch to generate. The default is <code class="highlighter-rouge">data</code>.</p>

    <p class="bs-callout bs-callout-info">In Magento 2.3 Alpha, the <code class="highlighter-rouge">setup:db-declaration:generate-patch</code> command was named <code class="highlighter-rouge">dev:generate:patch</code>.</p>
  </li>
  <li>
    <p>All released modules that previously used upgrade scripts must support backward compatibility by implementing
<code class="highlighter-rouge">\Magento\Setup\Model\Patch\PatchVersionInterface</code> and the <code class="highlighter-rouge">getVersion</code> method. This method allows you to skip changes that were applied in previous versions and were done by old scripts. The returned value of the <code class="highlighter-rouge">getVersion</code> method in this case should be equal to the value of a version in <code class="highlighter-rouge">version_compare</code> function in old scripts. When the <code class="highlighter-rouge">InstallData.php</code> script does not have any versions to compare, you can specify the first version of your module. See <a href="/guides/v2.3/extension-dev-guide/declarative-schema/data-patches.html">Develop declarative data and schema patches</a> for more information.</p>
  </li>
</ol>

<h2 id="dry-run-mode">Dry run mode</h2>

<p>It is important that declarative installation/upgrade does not break anything. A useful way to ensure this is use dry run mode to examine all the DDL SQL statements that are generated during the declarative installation process. In dry run mode, the database state does not change. The schemas and data will be the same before and after installation.</p>

<p>To enable dry run mode, run one of the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setup:install <span class="nt">--dry-run</span><span class="o">=</span>1
setup:upgrade <span class="nt">--dry-run</span><span class="o">=</span>1
</code></pre></div></div>

<p>As a result of specifying the <code class="highlighter-rouge">--dry-run=1</code> flag, Magento writes a log file at <code class="highlighter-rouge">&lt;Magento_Root&gt;/var/log/dry-run-installation.log</code>. This file contains all the DDL SQL statements that are generated during installation. You can use these SQL statements for debugging and optimizing performance processes.</p>

<h2 id="safe-installation-and-rollback">Safe installation and rollback</h2>

<p>The advantage and the main problem of declarative schema is that it can blindly modify the database schema. For example, a developer can make a mistake and potentially remove a structural element from the database, causing data loss.</p>

<p>To help prevent data loss, you can specify command line options that dump all the data that could be lost as a result of an installation. The dumped data can then be restored manually or automatically. These arguments are optional–you do not have to create a manual dump during a system upgrade. <em>(Note that this works only with schema.)</em></p>

<p>Magento provides options to the <code class="highlighter-rouge">setup:install</code> and <code class="highlighter-rouge">setup:upgrade</code> commands that enable safe installations and rollbacks:</p>

<p><code class="highlighter-rouge">--safe-mode</code> - Creates a data dump during the installation or upgrade process.</p>

<p><code class="highlighter-rouge">--data-restore</code> - (Used with the <code class="highlighter-rouge">setup:upgrade</code> command only.) Performs a rollback. Before you rollback, you must first check out code to the previous version of Magento. Then run <code class="highlighter-rouge">setup:upgrade  --data-restore</code>.</p>

<p>Several types of operations have an effect on data dumps and rollbacks.</p>

<ul>
  <li>
    <p><em>Destructive operations (DO)</em> - SQL DDL operations that cause data deletion or data corruption. The following operations are destructive:</p>

    <ul>
      <li>Deleting a table</li>
      <li>Deleting a column</li>
      <li>Reducing column length</li>
      <li>Changing column precision</li>
      <li>Changing the column type</li>
    </ul>
  </li>
  <li>
    <p><em>Opposite to destructive operations (ODO)</em> - In the case of a failed Magento installation, SQL DDL operations that are the opposite of  destructive operations can be used for rollback. For example, changing the column type from CHAR to INT is a destructive operation. The rollback operation changes the type from INT to CHAR.</p>
  </li>
</ul>

<p>When safe mode is enabled, Magento creates a CSV file each time a destructive operation for a table or column occurs. You can find these files at the following locations:</p>

<ul>
  <li><code class="highlighter-rouge">Magento_root/var/declarative_dumps_csv/{column_name_column_type_other_dimensions}.csv</code></li>
  <li><code class="highlighter-rouge">Magento_root/var/declarative_dumps_csv/{table_name}.csv</code></li>
</ul>

<p>Each CSV file contains a row that defines the column (or other database entity) names as well as rows of values, as shown in the following image:</p>

<p><img src="/guides/v2.3/extension-dev-guide/declarative-schema/images/dump_example.png" alt="Dump Example" /></p>

<h2 id="maintain-backward-compatibility">Maintain backward compatibility</h2>

<p>Backward compatibility must be maintained. Therefore, declarative schema does not automatically delete database tables, columns or keys that are not defined in a <code class="highlighter-rouge">db_schema.xml</code> file. Declarative schema can’t delete these elements because these items can be declared somewhere else, such as in an <code class="highlighter-rouge">Setup/UpgradeSchema.php</code> file.</p>

<p>The <code class="highlighter-rouge">&lt;module_vendor&gt;/&lt;module_name/etc/db_schema_whitelist.json</code> file provides a history of all tables, columns, keys added with declarative schema. It can be generated manually or created automatically with the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>magento setup:db-declaration:generate-whitelist <span class="o">[</span>options]
</code></pre></div></div>

<p>where <code class="highlighter-rouge">[options]</code> can be:</p>

<p><code class="highlighter-rouge">--module-name[=MODULE-NAME]</code> specifies which module to generate a whitelist for. If no module name is specified, then the default behavior is to generate a whitelist for all modules. You can also explicitly set <code class="highlighter-rouge">--module-name=all</code>.</p>

<p class="bs-callout bs-callout-info">In Magento 2.3 Alpha, the <code class="highlighter-rouge">setup:db-declaration:generate-whitelist</code> command was named <code class="highlighter-rouge">declaration:generate:whitelist</code>.</p>

<p>As a best practice, you should generate a new whitelist file for each release. You must generate the whitelist  in any release that contains changes in the <code class="highlighter-rouge">db_schema.xml</code> file.</p>

<p class="bs-callout bs-callout-info">This file is a temporary solution. It will be removed in the future, when upgrade scripts are no longer supported.</p>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  


  

    <div class="github-link">
      <a class="improve-page" href="https://github.com/magento/devdocs/blob/master/guides/v2.3/extension-dev-guide/declarative-schema/migration-commands.md" target="_blank">
        Edit this page on GitHub
      </a>
    </div>

    <div class="new-issue">
      <a href="https://github.com/magento/devdocs/issues/new?title=Feedback on page: /guides/v2.3/extension-dev-guide/declarative-schema/migration-commands.html" target="_blank">
        Give us feedback
      </a>
    </div>

  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav footer-links">
  <li><a href="https://github.com/magento/devdocs/blob/master/.github/CONTRIBUTING.md">Become a Contributor</a>
  <li><a href="https://magento.github.io/glossary/index.html?audience=developer">Glossary</a></li>
  <li><a href="http://magento.com/legal/terms/privacy/">Privacy Policy</a></li>
  <li><a href="http://magento.com/legal/terms/">Terms of Service</a></li>
  <li><a href="http://magento.com/legal/licensing/">License/Trademark FAQ</a></li>
  <!-- If the page is in the root, the link points to the default version of release notes.
       The default version is set in the config.yaml.-->
  <li><a href="/guides/v2.3/release-notes/bk-release-notes.html">Release Notes</a></li>
  <li><a href="/magento-third-party.html">Third-Party Licenses</a></li>
</ul>

    </div>

		<div class="copyright-date">&copy; 2018 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/assets/js/app.min.js"></script>






</body>
</html>

